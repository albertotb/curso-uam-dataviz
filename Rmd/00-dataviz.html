<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <title>Visualización de datos</title>
    <meta charset="utf-8" />
    <meta name="author" content="Alberto Torres Barrán" />
    <meta name="date" content="2020-02-27" />
    <link href="libs/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link rel="stylesheet" href="custom.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Visualización de datos
## Explotación y visualización
### Alberto Torres Barrán
### 2020-02-27

---

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: {
    Macros: {
      Xcal: "{\\mathcal{X}}",
      Xbf: "{\\mathbf{X}}",
      Qbf: "{\\mathbf{Q}}",
      Zbf: "{\\mathbf{Z}}",
      Vbf: "{\\mathbf{V}}",
      Hbf: "{\\mathbf{H}}",
      Rbb: "{\\mathbb{R}}"
    },
    extensions: ["AMSmath.js","AMSsymbols.js"]
  }
});
</script>




## Gramática de gráficos

* Descripción precisa de todos los componentes necesarios para realizar una visualización 

  * Wilkinson, L. (2005), *The Grammar of Graphics*

* Una de las implementaciones más conocidas es la librería `ggplot2`:

    * Wickham, H. (2009), [*ggplot2: Elegant Graphics for Data Analysis*](https://ggplot2-book.org/)

* Artículo con las implicaciones de trasladar los conceptos de la gramática de gráficos a un lenguaje de programación (R):

    * Wickham, H. (2010), [*A Layered Grammar of Graphics*](https://vita.had.co.nz/papers/layered-grammar.pdf)


---

## Fundamentos de visualización de datos

* Wilke, C. O., (2019) [Fundamentals of data visualization](https://serialmentor.com/dataviz/)

* Guía moderna para realizar visualizaciones que:

  1. reflejan los datos de forma precisa
  
  2. cuentan una historia
  
  3. tienen una estética profesional
  
* Conceptos independientes de la herramienta que se usa!

* Los ejemplos del libro están hechos con `ggplot2` y otras librerías auxiliares

* Referencia principal de esta sesión (material en [Github](http://albertotb.com/curso-uam-dataviz/))

---

class: inverse, center, middle

# Visualización de datos

---

## Características estéticas

* Toda visualización es una correspondencia entre datos y características estéticas

* Ejemplo: un gráfico de dispersión representa la relación entre dos variables, **x** e **y**, mediante puntos

* Dos tipos:

  1. pueden representar datos continuos
  
  2. **no** pueden representar datos continuos
  
---

## Ejemplos

![:vspace 4]

.center[
![](img/common-aesthetics-1.png)
]

---

## Tipos de datos

* Independientes del lenguaje de programación/herramienta!

  1. **Numéricos continuos**: números decimales
  
  2. **Numéricos discretos**: por ej. números enteros
  
  3. **Categóricos**: con o sin orden, por ej. las CC.AA de España
  
  4. **Fechas/horas**: pueden ser continuos o discretos dependiendo de lo que representen
  
  5. **Texto**


---

## Ejemplo

¿Qué tipos de datos hay en la siguiente tabla?



&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; Fecha y hora &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Temperatura (ºC) &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Viento (km/h) &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Dirección del viento &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Estacion &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 27/02/2020 00:00 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 7.1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 4 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Noroeste &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; El Goloso &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 27/02/2020 01:00 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 6.3 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Oeste &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; El Goloso &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 27/02/2020 02:00 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 6.3 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 5 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Oeste &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; El Goloso &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 27/02/2020 03:00 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 6.6 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 4 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Oeste &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; El Goloso &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 27/02/2020 04:00 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 5.9 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Oeste &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; El Goloso &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 27/02/2020 05:00 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 4.3 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Calma &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; El Goloso &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 27/02/2020 06:00 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 4.2 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Sudoeste &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; El Goloso &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 27/02/2020 07:00 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 4.6 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Calma &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; El Goloso &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 27/02/2020 08:00 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 6.4 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 6 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Oeste &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; El Goloso &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 27/02/2020 09:00 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 7.3 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 13 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Oeste &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; El Goloso &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 27/02/2020 10:00 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 9.4 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 11 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Oeste &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; El Goloso &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

.center[
Fuente: [AEMET](http://www.aemet.es/es/eltiempo/observacion/ultimosdatos)
]

---

## Escalas

* Definen la equivalencia entre valores y elementos del gráfico

* Correspondencia 1 a 1 para evitar gráficos ambiguos

![:vspace 3]

.center[
![](img/basic-scales-example-1.png)
]

---

## Ejemplo gráfico de líneas

.center[
![](img/temp-normals-vs-time-1.png)
]
---

## Ejemplo *heatmap*

![:vspace 8]

.center[
![](img/four-locations-temps-by-month-1.png)
]

---

## Múltiples escalas

¿Cuántas escalas tiene el siguiente gráfico?

.center[
![:scale 75%](img/mtcars-five-scale-1.png)
]

---

class: inverse, center, middle

# Sistemas de coordenadas y ejes

---

## Sistemas de coordenadas

* Necesarios para cualquier tipo de visualización

* Determinan donde se van a posicionar los distintos valores

* Para gráficos estándar en 2D, necesitamos 2 valores para identificar una posición

* Además también necesitamos especificar la distribución relativa

* **Sistema de coordenadas**: combinación de escalas de posición y su distribución relativa

---

## Coordenadas cartesianas

* Sistema de coordenadas más habitual

* Dos ejes ortogonales con escalas continuas, **x** e **y**

* Invariantes frente a transformaciones lineales

.center[
![:scale 60%](img/cartesian-coord-1.png)
]

---

## Ejemplo

.center[
![:scale 90%](img/temperature-normals-Houston-1.png)
]

---

## Ejes lineales vs no lineales

* **Eje lineal**: la separación entre dos líneas de la rejilla es la misma en la visualización que en las unidades de los datos

* **Eje no lineal**: la distancia entre dos líneas de la rejilla no es proporcional a la separación en las unidades de los datos

![:vspace 0.5]

.center[
![:scale 80%](img/linear-log-scales-1.png)
]

---

## Escala logaritmica

* Escala no lineal más común

* Multiplicar en la escala logarítmica es como sumar en la escala lineal

* Conveniente para datos que provienen de multiplicaciones/divisiones, por ej. ratios

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:right;"&gt; poblacion &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; media &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; ratio &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 50 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 100 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.5 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 100 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 100 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 200 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 100 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2.0 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

![:vspace 3]

&lt;img src="00-dataviz_files/figure-html/unnamed-chunk-4-1.png" style="display: block; margin: auto;" /&gt;

---

## Otras escalas

* Escala logarítmica es también útil cuando hay datos con magnitudes muy diferentes
  * Representar en una misma escala una ciudad con población 100 y otra con población 1M
  
* Problema: no puede haber 0 en la escala logarítimica (`log(0) = -inf`)

* En algunos casos pueden ser útiles otras transformaciones, por ej. la raíz cuadrada

---

## Ejemplo

![:vspace 7]

.center[
![](img/northeast-state-areas-1.png)
]

---

## Sistemas de coordenadas  curvos

* Las coordenadas polares son el ejemplo más común

* Especificamos una posición usando un ángulo y una distancia radial al origen

* Útiles para datos con periodicidad intrínseca

![:vspace 2]

.center[
![:scale 80%](img/polar-coord-1.png)
]

---

## Ejemplo

.center[
![](img/temperature-normals-polar-1.png)
]

---

## Datos geográficos

![](img/worldmap-four-projections-1.png)

---

## Otro ejemplo

.center[
![:scale 90%](img/mtcars_polar.png)

Fuente: [ggradar](https://www.ggplot2-exts.org/ggradar.html)
]


---

## Otro (mal) ejemplo

.center[
![:scale 80%](img/dia_polar.png)

Fuente: [Radar Plots usando ggplot2](https://rpubs.com/htejero/212368)
]

---

class: inverse, middle, center

# Escalas de color

---

## Escalas de color cualitativas

* En variables categóricas, usamos el color para distinguir grupos que no tienen ningún orden

* Características deseables:

  1. claramente **distinguibles** unos de otros
  
  2. **equivalentes**  
     * ningún color puede destacar sobre el resto
  
  3. distinguibles incluso para personas **daltónicas**

---

## Ejemplos

* Se pueden crear escalas personalizadas en la web [ColorBrewer 2.0](http://colorbrewer2.org/)

* También hay muchas disponibles:
    
  ![:scale 75%](img/qualitative-scales-1.png)

* A no ser que exista alguna razón de peso (por ej. colores corporativos), siempre es recomendable usar una de las múltiples escalas por defecto

* Muchas fueron creadas para cumplir las propiedades anteriores:
  
  * .footnotesize[Okabe, M., and K. Ito. (2008), [Color Universal Design (CUD): How to Make Figures and Presentations That Are Friendly to Colorblind People.](https://jfly.uni-koeln.de/color/)]



---

## Escalas de color secuenciales

* Con variables continuas, usamos escalas de color secuenciales

* Revelan patrones en nuestros datos que sería muy complicado ver de otra forma

* Simplifican a nuestro cerebro la tarea de procesar...
  
  * ...que valores son más pequeños que otros
  * ...distancia entre valores
  
* Características deseables [[A better default colormap for matplotlib](https://www.youtube.com/watch?v=xAoljeRJ3lU)]:

  1. colorida
  
  2. agradable
  
  3. **secuencial**
  
  4. **perceptualmente uniforme**
  
  5. distinguible en **blanco y negro**
  
  6. accesible para personas **daltónicas**

---

## viridis

![](img/viridis.png)

.center[Fuente: [mpl colormaps](https://bids.github.io/colormap/)]

---

## Secuenciales vs divergentes

.center[
![:scale 70%](img/sequential-scales-1.png)
]

--

![:vspace 0.5]

.center[
![:scale 70%](img/diverging-scales-1.png)
]

---

## Ejemplo secuencial

.center[
![:scale 90%](img/map-Texas-income-1.png)
]

---

## Ejemplo divergente

.center[
![:scale 90%](img/map-Texas-race-1.png)
]

---

## Destacar elementos usando color

* Las escalas de color qualitativas se pueden modificar para resaltar ciertos grupos:

  * creando versiones más oscuras y/o saturadas de algunos colores
  
  * combinando una escala de grises + color

* Importante que ninguno de los colores no-resaltados destaque sobre el resto!

.center[
![:scale 75%](img/accent-scales-1.png)
]

* Otra opción es eliminar todo el color excepto el de los datos a resaltar

---

## Ejemplo resaltado

.center[
![](img/Aus-athletes-track-1.png)
]

---

class: inverse, middle, center

# Tipos de gráficos

---

## Cantidades

---

## Distribuciones

---

## Proporciones

---

## Asociaciones de variables cuantitativas

---

## Series temporales

---

## Tendencias

---

## Datos geoespaciales
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="macros.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
